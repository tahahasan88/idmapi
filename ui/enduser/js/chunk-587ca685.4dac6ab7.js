/*!
 * Copyright 2019-2020 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-587ca685"],{"484a":function(e,t,a){},"9e67":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{ref:"fsModal",attrs:{id:"userDetailsModal","modal-class":"fr-full-screen","cancel-variant":"outline-secondary"},on:{show:e.setModal},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.saveForm(t))}}},[a("div",{staticClass:"d-flex w-100 h-100",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title align-self-center text-center"},[e._v(e._s(e.title))]),a("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:e.hideModal}},[a("i",{staticClass:"fa fa-times"})])]),a("b-container",[a("b-row",[a("b-col",{attrs:{sm:"8","offset-sm":"2"}},[a("ValidationObserver",{ref:"observer",attrs:{slim:""}},[e.formFields.length>0?a("b-form",{staticClass:"mb-3 fr-edit-personal-form",staticStyle:{"flex-direction":"column"},attrs:{name:"edit-personal-form"}},[e._l(e.formFields,(function(t,r){return["string"!==t.type&&"number"!==t.type||!t.userEditable?e._e():a("b-form-group",{key:r,staticStyle:{"min-width":"200px"}},[a("label",{attrs:{for:t.title}},[e._v(e._s(t.title))]),t.required?e._e():a("small",{staticClass:"text-muted ml-1"},[e._v(e._s(e.$t("pages.profile.editProfile.optional")))]),a("ValidationProvider",{attrs:{rules:t.required?"required":"",name:t.name},scopedSlots:e._u([{key:"default",fn:function(i){return[a("b-input",{attrs:{name:t.name,type:"string"===t.type?"text":t.type,state:e.getValidationState(i)},model:{value:e.formFields[r].value,callback:function(t){e.$set(e.formFields[r],"value","string"===typeof t?t.trim():t)},expression:"formFields[index].value"}}),a("b-form-invalid-feedback",[e._v(e._s(i.errors[0]))])]}}],null,!0)})],1),"boolean"===t.type?a("b-form-group",{key:r},[a("div",{staticClass:"d-flex flex-column"},[a("label",{staticClass:"mr-auto",attrs:{for:t.title}},[e._v(e._s(t.title))]),a("b-form-checkbox",{staticClass:"fr-toggle-primary",attrs:{switch:"",size:"lg"},model:{value:e.formFields[r].value,callback:function(t){e.$set(e.formFields[r],"value",t)},expression:"formFields[index].value"}},[e._v(" "+e._s(e.formFields[r].value?e.$t("common.form.yes"):e.$t("common.form.no"))+" ")])],1)]):e._e()]}))],2):[a("h3",{staticClass:"text-center"},[e._v(e._s(e.$t("pages.profile.editProfile.noFields")))])]],2)],1)],1)],1),a("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("div",{staticClass:"float-right"},[a("b-btn",{attrs:{variant:"outline-secondary mr-2"},on:{click:e.hideModal}},[e._v(e._s(e.$t("common.form.cancel")))]),a("b-btn",{attrs:{type:"button",variant:"primary",disabled:e.$root.userStore.state.internalUser},on:{click:e.saveForm}},[e._v(e._s(e.$t("common.form.saveChanges")))])],1)])],1)},i=[],o=a("2ef0"),n=a.n(o),l=a("eea2"),s={name:"Edit-Personal-Info",mixins:[l["a"]],components:{},props:{schema:{type:Object,required:!0},profile:{type:Object,required:!0},autoOpen:{type:Boolean,required:!1,default:!1}},data:function(){return{formFields:[],originalFormFields:[],title:this.$t("pages.profile.editProfile.userDetailsTitle")}},mounted:function(){this.autoOpen&&this.$root.$emit("bv::show::modal","userDetailsModal")},methods:{generateFormFields:function(){var e=this,t=this.schema,a=t.order,r=t.properties,i=t.required,o=n.a.filter(a,(function(e){return r[e].viewable&&"array"!==r[e].type&&"object"!==r[e].type})),l=n.a.map(o,(function(t){return{name:t,key:t,title:r[t].title,userEditable:r[t].userEditable,value:e.profile[t]||null,type:r[t].type,required:n.a.includes(i,t)}}));return l},hideModal:function(){this.$refs.fsModal.hide()},setModal:function(){var e=this.generateFormFields();this.formFields=e,this.originalFormFields=n.a.cloneDeep(e)},saveForm:function(){var e=this;this.$refs.observer.validate().then((function(t){if(t){var a=e.getRequestService(),r={};n.a.each(e.formFields,(function(e){null!==e.value&&(r[e.name]=e.value)})),a.post("policy/".concat(e.$root.userStore.state.managedResource,"/").concat(e.$root.userStore.state.userId,"?_action=validateObject"),r).then((function(t){if(t.data.failedPolicyRequirements=n.a.remove(t.data.failedPolicyRequirements,(function(t){return!n.a.map(e.formFields,"name").includes(t.property)})),0===t.data.failedPolicyRequirements.length)e.$emit("updateProfile",e.generateUpdatePatch(e.originalFormFields,e.formFields)),e.$refs.observer.reset(),e.hideModal();else{var a=e.findPolicyError({data:{detail:{failedPolicyRequirements:t.data.failedPolicyRequirements}}},e.formFields);if(a.length>0){var r={};n.a.each(a,(function(e){e.exists&&(void 0!==r[e.field]?r[e.field].push(e.msg):r[e.field]=[e.msg])})),e.$refs.observer.setErrors(r)}else e.displayNotification("error",e.$t("pages.profile.editProfile.failedProfileSave"))}}))}}))}}},c=s,u=(a("e03f"),a("2877")),d=Object(u["a"])(c,r,i,!1,null,null,null);t["default"]=d.exports},e03f:function(e,t,a){"use strict";a("484a")},eea2:function(e,t,a){"use strict";var r,i,o=a("2ef0"),n=a.n(o),l={name:"Resource-Mixin",methods:{generateUpdatePatch:function(e,t){var a,r=n.a.cloneDeep(e),i=n.a.cloneDeep(t);return n.a.isArray(i)?a=n.a.filter(i,(function(e,t){return e.value!==r[t].value})):(a=[],n.a.each(i,(function(e,t){n.a.isEqual(r[t],i[t])||a.push({value:i[t],name:t})}))),n.a.map(a,(function(e){return""===e.value||null===e.value?{operation:"remove",field:"/"+e.name}:{operation:"add",field:"/"+e.name,value:e.value}}))},findPolicyError:function(e,t){var a=this,r=[];return n.a.has(e,"data.detail.failedPolicyRequirements")&&n.a.each(e.data.detail.failedPolicyRequirements,(function(e){if(e.policyRequirements.length>0){var i="",o=n.a.find(t,(function(t){return t.key===e.property})),l=e.policyRequirements[0].params||{};o&&(i=o.title?o.title:o.key,l.property=i),r.push({exists:i.length>0,field:e.property,msg:a.$t("common.policyValidationMessages.".concat(e.policyRequirements[0].policyRequirement),l)})}})),r},generateSearch:function(e,t,a){var r="";return e.length>0?(e=encodeURIComponent(e),n.a.each(t,(function(i,o){var l="string";n.a.isUndefined(a)||(l=a[i].type),r=("number"!==l||n.a.isNaN(n.a.toNumber(e)))&&("boolean"!==l||"true"!==e&&"false"!==e)?o+1<t.length?"".concat(r).concat(i,'+sw+"').concat(e,'"+OR+'):"".concat(r).concat(i,'+sw+"').concat(e,'"'):o+1<t.length?"".concat(r).concat(i,"+eq+ ").concat(e,"+OR+"):"".concat(r).concat(i,"+eq+ ").concat(e)}))):r="true",r}}},s=l,c=a("2877"),u=Object(c["a"])(s,r,i,!1,null,null,null);t["a"]=u.exports}}]);
//# sourceMappingURL=chunk-587ca685.4dac6ab7.js.map