/*!
 * Copyright 2019-2020 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-902838e8"],{"943f":function(e,t,s){"use strict";s("e53c")},cbf6:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-container",[s("div",{staticClass:"card mt-4"},[s("div",{staticClass:"card-header py-2"},[s("b-row",[s("b-col",{staticClass:"my-1",attrs:{md:"3"}},[e.createProperties.length>0?s("b-btn",{directives:[{name:"b-modal",rawName:"v-b-modal.createResourceModal",modifiers:{createResourceModal:!0}}],attrs:{type:"button",variant:"primary"}},[s("i",{staticClass:"fa fa-plus mr-3"}),e._v(e._s(e.$t("common.form.new"))+" "+e._s(this.name))]):e._e()],1),s("b-col",{staticClass:"my-1",attrs:{md:"9"}},[s("div",{staticClass:"d-flex"},[s("b-input-group",[s("b-input-group-prepend",[s("div",{staticClass:"input-group-text inset"},[s("i",{staticClass:"fa fa-search"})])]),s("b-form-input",{staticClass:"inset-left inset-right",attrs:{placeholder:e.searchPlaceholder},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),s("b-input-group-append",[s("b-btn",{staticClass:"inset clear",attrs:{variant:"outline-default",disabled:!e.filter},on:{click:e.clear}},[s("i",{staticClass:"fa fa-times-circle"})])],1)],1)],1)])],1)],1),s("div",{staticClass:"card-body"},[s("b-table",{staticClass:"mb-0",class:[{"hide-header":e.isLoading||!e.gridData.length}],attrs:{"show-empty":"","table-responsive":"",stacked:"lg",items:e.gridData,fields:e.columns,"per-page":0,hover:e.tableHover,"sort-by":e.sortBy,"sort-desc":e.sortDesc,"no-local-sorting":!0,"sort-direction":e.sortDirection,busy:e.isLoading},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t},"row-clicked":e.resourceClicked,"sort-changed":e.sortingChanged},scopedSlots:e._u([{key:"table-busy",fn:function(){return[s("div",{staticClass:"text-center p-5"},[s("b-spinner",{staticClass:"align-middle spinner-large text-primary my-4"}),s("div",[e._v(e._s(e.$t("common.form.loading"))+" "+e._s(e.plural(e.name))+"...")])],1)]},proxy:!0}])})],1),e.isLoading?e._e():s("div",{staticClass:"card-footer py-2"},[s("nav",{attrs:{"aria-label":"Page navigation example"}},[s("ul",{staticClass:"pagination justify-content-center mb-0"},[s("li",{class:[{disabled:1===e.currentPage},"page-item"],on:{click:function(t){t.preventDefault(),1!==e.currentPage&&e.paginationChange(1)}}},[s("a",{staticClass:"page-link",attrs:{href:"#"}},[s("i",{staticClass:"fa fa-angle-double-left"})])]),s("li",{class:[{disabled:1===e.currentPage},"page-item"],on:{click:function(t){t.preventDefault(),1!==e.currentPage&&e.paginationChange(e.currentPage-1)}}},[s("a",{staticClass:"page-link",attrs:{href:"#"}},[s("i",{staticClass:"fa fa-angle-left"})])]),s("li",{class:[{disabled:e.lastPage},"page-item"],on:{click:function(t){t.preventDefault(),!e.lastPage&&e.paginationChange(e.currentPage+1)}}},[s("a",{staticClass:"page-link",attrs:{href:"#"}},[s("i",{staticClass:"fa fa-angle-right"})])])])])])]),e.createProperties.length>0?s("fr-create-resource",{attrs:{resourceName:e.name,resourceType:e.resource,createProperties:e.createProperties},on:{refreshGrid:e.clear}}):e._e()],1)},r=[],i=s("2ef0"),o=s.n(i),n=s("761a"),l=s.n(n),c=s("bc3a"),d=s.n(c),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-modal",{ref:"createModal",attrs:{id:"createResourceModal","cancel-variant":"outline-secondary"},on:{shown:e.focusField},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.saveForm(t))}}},[s("div",{staticClass:"d-flex w-100 h-100",attrs:{slot:"modal-header"},slot:"modal-header"},[s("h5",{staticClass:"modal-title align-self-center text-center"},[e._v(e._s(e.$t("common.form.new"))+" "+e._s(e.resourceName))]),s("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:e.hideModal}},[s("i",{staticClass:"fa fa-times"})])]),s("b-row",[s("b-col",[s("ValidationObserver",{ref:"observer",attrs:{slim:""}},[e.createProperties.length>0?s("b-form",{staticClass:"mb-3",attrs:{name:"edit-personal-form"}},[e._l(e.createProperties,(function(t,a){return["string"!==t.type&&"number"!==t.type||void 0!==t.encryption?e._e():s("b-form-group",{key:"createResource"+a},[t.title?s("label",{staticClass:"float-left",attrs:{for:"create-resource-"+t.key}},[e._v(e._s(t.title))]):s("label",{staticClass:"float-left",attrs:{for:"create-resource-"+t.key}},[e._v(e._s(t.key))]),s("ValidationProvider",{attrs:{rules:t.required?"required":"",name:t.title,vid:t.key},scopedSlots:e._u([{key:"default",fn:function(a){return[s("b-form-input",{attrs:{id:"create-resource-"+t.key,type:"string"===t.type?"text":t.type,state:e.getValidationState(a)},model:{value:e.formFields[t.key],callback:function(s){e.$set(e.formFields,t.key,"string"===typeof s?s.trim():s)},expression:"formFields[field.key]"}}),s("b-form-invalid-feedback",[e._v(e._s(a.errors[0]))])]}}],null,!0)})],1),"array"===t.type&&"relationship"===t.items.type?s("b-form-group",{key:"createResource"+a},[s("fr-relationship-edit",{attrs:{relationshipProperty:t,index:a,setValue:e.setRelationshipArrayValue,newResource:!0}})],1):e._e(),"boolean"===t.type?s("b-form-group",{key:"createResource"+a},[s("div",{staticClass:"d-flex flex-column"},[s("label",{staticClass:"mr-auto",attrs:{for:t.title}},[e._v(e._s(t.title))]),s("b-form-checkbox",{staticClass:"fr-toggle-primary",attrs:{switch:"",size:"lg"},model:{value:e.formFields[t.key],callback:function(s){e.$set(e.formFields,t.key,s)},expression:"formFields[field.key]"}},[e._v(" "+e._s(e.formFields[t.key]?e.$t("common.form.yes"):e.$t("common.form.no"))+" ")])],1)]):e._e(),"relationship"===t.type?s("b-form-group",{key:"createResource"+a},[s("fr-relationship-edit",{attrs:{relationshipProperty:t,index:a,setValue:e.setSingletonRelationshipValue,newResource:!0}})],1):e._e()]})),e.passwordCheck?s("fr-password-policy-input",{attrs:{policyApi:e.resourceType+"/"+e.resourceName+"/policyTest"},model:{value:e.formFields["password"],callback:function(t){e.$set(e.formFields,"password",t)},expression:"formFields['password']"}},[s("b-form-group",{staticClass:"mb-3",attrs:{slot:"custom-input"},slot:"custom-input"},[s("label",{attrs:{for:"createPassword"}},[e._v(e._s(e.$t("pages.access.password")))]),s("div",{staticClass:"form-label-password form-label-group mb-0"},[s("b-form-input",{directives:[{name:"validate",rawName:"v-validate.initial",value:"required|policy",expression:"'required|policy'",modifiers:{initial:!0}}],attrs:{id:"createPassword",autocomplete:"password",type:e.passwordInputType,name:"password"},model:{value:e.formFields["password"],callback:function(t){e.$set(e.formFields,"password",t)},expression:"formFields['password']"}}),s("div",{staticClass:"input-group-append"},[s("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:e.revealNew}},[s("i",{class:[{"fa-eye-slash":!e.showPassword},{"fa-eye":e.showPassword},"fa"]})])])],1)])],1):e._e()],2):[s("h3",{staticClass:"text-center"},[e._v(e._s(e.$t("pages.access.noFields")))])]],2)],1)],1),s("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[s("div",{staticClass:"float-right"},[s("b-btn",{attrs:{variant:"outline-secondary mr-2"},on:{click:e.hideModal}},[e._v(e._s(e.$t("common.form.cancel")))]),s("b-btn",{attrs:{type:"button",variant:"primary",disabled:e.disabled||0===e.formFields.length},on:{click:e.saveForm}},[e._v(e._s(e.$t("common.form.save")))])],1)])],1)},p=[],f=s("f8f2"),h=s("f13c"),m=s("eea2"),y={name:"Create-Resource",components:{"fr-password-policy-input":f["a"],"fr-relationship-edit":h["a"]},mixins:[m["a"]],props:{createProperties:{type:Array,required:!0,default:function(){return[]}},resourceName:{type:String,required:!0},resourceType:{type:String,required:!0}},data:function(){var e={},t=!1;return o.a.each(this.createProperties,(function(s){"string"===s.type||"number"===s.type?e[s.key]="":"relationship"===s.type?e[s.key]=null:"array"===s.type&&"relationship"===s.items.type?e[s.key]=[]:e[s.key]=!1,"password"===s.key&&(t=!0)})),{formFields:e,passwordCheck:t,passwordInputType:"password",showPassword:!0,disabled:!1}},methods:{saveForm:function(){var e=this,t=this.getRequestService();this.$refs.observer.validate().then((function(s){if(s){var a=e.cleanData(o.a.clone(e.formFields));e.disabled=!0,t.post("".concat(e.resourceType,"/").concat(e.resourceName,"?_action=create"),a).then((function(){e.$emit("refreshGrid"),e.$refs.observer.reset(),e.hideModal(),e.displayNotification("success",e.$t("pages.access.successCreate",{resource:o.a.capitalize(e.resourceName)}))})).catch((function(t){var s=e.findPolicyError(t.response,e.createProperties);if(s.length>0){var a={};o.a.each(s,(function(e){e.exists&&(void 0!==a[e.field]?a[e.field].push(e.msg):a[e.field]=[e.msg])})),e.$refs.observer.setErrors(a)}else e.displayNotification("error",e.$t("pages.access.invalidCreate"))})).finally((function(){e.disabled=!1}))}else e.displayNotification("error",e.$t("pages.access.invalidCreate"))}))},hideModal:function(){this.resetDialog(),this.$refs.createModal.hide()},resetDialog:function(){var e=this;this.$refs.observer&&this.$refs.observer.reset(),this.passwordInputType="password",this.showPassword=!0,o.a.each(this.formFields,(function(t,s){var a=o.a.find(e.createProperties,{key:s});o.a.isString(t)||o.a.isNumber(t)?e.formFields[s]="":o.a.isArray(t)?e.formFields[s]=[]:"boolean"===a.type?e.formFields[s]=!1:e.formFields[s]=null}))},revealNew:function(){"password"===this.passwordInputType?(this.passwordInputType="text",this.showPassword=!1):(this.passwordInputType="password",this.showPassword=!0)},cleanData:function(e){return o.a.each(e,(function(t,s){(o.a.isString(t)&&0===t.length||o.a.isArray(t)&&0===t.length)&&delete e[s]})),e},focusField:function(){o.a.isArray(this.$refs.focusInput)&&this.$refs.focusInput[0].focus()},getRelationshipDisplayFields:function(e,t){return o.a.find(e.resourceCollection,{path:t._refResourceCollection}).query.fields},setSingletonRelationshipValue:function(e,t){this.formFields[e]=t},setRelationshipArrayValue:function(e,t){var s=this.formFields[e];t&&s&&-1===o.a.findIndex(s,{_ref:t._ref})&&s.push(t)}}},g=y,b=s("2877"),v=Object(b["a"])(g,u,p,!1,null,null,null),k=v.exports,w={name:"Access",components:{"fr-create-resource":k},mixins:[m["a"]],data:function(){return{name:this.$route.params.resourceName,resource:this.$route.params.resourceType,schemaProperties:{},isRowSelected:!1,tableHover:!0,gridData:[],columns:[],displayFields:[],currentPage:1,lastPage:!1,sortBy:null,sortDesc:!1,sortDirection:"asc",filter:"",createProperties:[],userCanUpdate:!1,isLoading:!0,queryThreshold:null}},mounted:function(){this.loadData()},watch:{gridData:function(){var e=this;this.columns=this.columns.map((function(t){return"actions"!==t.key&&(t.sortable=!e.queryThreshold||e.filter.length>=e.queryThreshold),t}))}},computed:{searchPlaceholder:function(){return this.queryThreshold?this.$t("pages.access.typeAtLeastAndEnterToSearch",{numChars:this.queryThreshold}):this.$t("pages.access.typeAndEnterToSearch")}},methods:{loadData:function(){var e=this,t=this.getRequestService(),s=this.$root.applicationStore.state.managedObjectsSettings;s&&s[this.name]&&(this.queryThreshold=s[this.name].minimumUIFilterLength),d.a.all([this.getSchema("".concat(this.resource,"/").concat(this.name)),t.get("privilege/".concat(this.resource,"/").concat(this.name))]).then(d.a.spread((function(t,s){s.data.VIEW.allowed&&o.a.each(s.data.VIEW.properties,(function(s){var a=t.data.properties[s];e.columns.length<=3&&o.a.isUndefined(a.encryption)&&o.a.includes(["string","boolean","number"],a.type)&&(e.columns.push({key:s,label:a.title,sortable:!0,sortDirection:"desc"}),e.displayFields.push(s))})),s.data.UPDATE&&(e.userCanUpdate=!0),e.schemaProperties=t.data.properties,s.data.CREATE.allowed&&o.a.each(s.data.CREATE.properties,(function(s){var a=t.data.properties[s].type;("string"===a||"number"===a||"boolean"===a||"relationship"===a||"array"===a&&"relationship"===t.data.properties[s].items.type)&&(t.data.properties[s].key=s,o.a.each(t.data.required,(function(e){e===t.data.properties[s].key&&(t.data.properties[s].required=!0)})),e.createProperties.push(t.data.properties[s]))})),e.loadGrid("true",e.displayFields,e.displayFields[0],1)}))).catch((function(t){e.displayNotification("error",t.response.data.message)}))},loadGrid:function(e,t,s,a){var r=this,i=this.getRequestService();this.isLoading=!0,i.get(this.buildGridUrl(e,t,s,a)).then((function(e){e.data.pagedResultsCookie?r.lastPage=!1:r.lastPage=!0,r.gridData=e.data.result,r.isLoading=!1})).catch((function(e){r.isLoading=!1,r.displayNotification("error",e.response.data.message)}))},buildGridUrl:function(e,t,s,a){var r="".concat(this.resource,"/").concat(this.name,"?_queryFilter=").concat(e,"&_pageSize=10");if(o.a.isNull(s)&&(s=t[0]),this.queryThreshold&&""===this.filter||(r="".concat(r,"&_sortKeys=").concat(s)),t.length&&(r="".concat(r,"&_fields=").concat(t.join(","))),a>1){var i=10*(a-1);r="".concat(r,"&_pagedResultsOffset=").concat(i)}return r},calculateSort:function(e,t){var s=null;return o.a.isNull(t)||(s=e?"".concat(t):"-".concat(t)),s},sortingChanged:function(e){this.currentPage=1,this.lastPage=!1,this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,this.calculateSort(e.sortDesc,e.sortBy),1)},paginationChange:function(e){this.currentPage=e,this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,this.calculateSort(this.sortDesc,this.sortBy),e)},search:function(){this.sortBy=null,this.sortDesc=!1,this.currentPage=1,this.lastPage=!1,(!this.queryThreshold||!this.filter.length||this.filter.length>=this.queryThreshold)&&this.loadGrid(this.generateSearch(this.filter,this.displayFields,this.schemaProperties),this.displayFields,null,1)},clear:function(){this.filter="",this.sortBy=null,this.sortDesc=!1,this.currentPage=1,this.loadGrid("true",this.displayFields,null,1)},resourceClicked:function(e){this.userCanUpdate?this.$router.push({name:"EditResource",params:{resourceType:this.resource,resourceName:this.name,resourceId:e._id}}):this.displayNotification("error",this.$t("pages.access.unableToEditResource",{resource:this.name}))},plural:function(e){return l()(e)}}},C=w,_=(s("943f"),Object(b["a"])(C,a,r,!1,null,"604a2e86",null));t["default"]=_.exports},e53c:function(e,t,s){}}]);
//# sourceMappingURL=chunk-902838e8.bda5e9ec.js.map