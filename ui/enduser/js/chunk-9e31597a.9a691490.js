/*!
 * Copyright 2019-2020 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9e31597a"],{"2d6f":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return null!==e.selfServiceType&&"parameters"!==e.selfServiceType?s("fr-center-card",{attrs:{showLogo:!0}},[s("div",{attrs:{slot:"center-card-header"},slot:"center-card-header"},[s("h2",{staticClass:"h2"},[e._v(e._s(e.$t("pages.selfservice.headers.reset.title")))])]),s("b-card-body",{attrs:{slot:"center-card-body"},slot:"center-card-body"},[s(e.selfServiceType,{ref:"selfServiceStage",tag:"component",attrs:{selfServiceDetails:e.selfServiceDetails,apiType:e.apiType},on:{advanceStage:e.advanceStage}})],1),s("b-card-footer",{attrs:{slot:"center-card-footer"},slot:"center-card-footer"},[s("b-link",{attrs:{href:"#/login"}},[e._v(e._s(e.$t("pages.selfservice.signIn")))])],1)],1):s("b-container",{staticClass:"h-100 px-0",attrs:{fluid:""}},[s("div",{staticClass:"h-100 d-flex"},[s("div",{staticClass:"m-auto fr-center-card"},[s("bounce-loader",{attrs:{color:e.loadingColor}})],1)])])},a=[],r=s("2ef0"),n=s.n(r),o=s("8455"),l=s("b107"),c=s.n(l),u=s("13bf"),p=s("5aa8"),f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-alert",{attrs:{show:""}},[e._v(" "+e._s(e.$t("pages.selfservice.headers."+e.apiType+".emailSent"))+" ")])},d=[],m={name:"Email-Validation",props:{apiType:{required:!0}}},y=m,v=s("2877"),h=Object(v["a"])(y,f,d,!1,null,null,null),b=h.exports,g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ValidationObserver",{ref:"observer",attrs:{slim:""}},[s("b-form",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save(t)},submit:function(e){e.preventDefault()}}},[s("p",{staticClass:"text-center mb-4"},[e._v(" "+e._s(e.$t("pages.selfservice.passwordReset.kbaVerificationStageDescription"))+" ")]),e._l(e.answers,(function(t,i){return s("div",{key:i,staticClass:"form-group text-left"},[s("ValidationProvider",{attrs:{rules:"required",name:e.questionText[i],vid:i},scopedSlots:e._u([{key:"default",fn:function(t){return[s("label",{staticClass:"col-form-label pt-0 pb-2",attrs:{for:i}},[e._v(e._s(e.questionText[i]))]),s("b-form-input",{key:i,ref:i,refInFor:!0,attrs:{autofocus:!0,name:i,id:i},model:{value:e.answers[i],callback:function(t){e.$set(e.answers,i,"string"===typeof t?t.trim():t)},expression:"answers[key]"}}),s("b-form-invalid-feedback",[e._v(e._s(t.errors[0]))])]}}],null,!0)})],1)})),s("b-button",{attrs:{block:!0,size:"lg",variant:"primary"},on:{click:e.save}},[e._v(" "+e._s(e.$tc("common.user.kba.submitAnswers",e.selfServiceDetails.requirements.required.length))+" ")])],2)],1)},w=[],_={name:"Kba-Verification",components:{},props:{selfServiceDetails:{required:!0}},data:function(){var e=this.$i18n,t=e.locale,s=e.fallbackLocale,i=this.selfServiceDetails.requirements,a=i.properties,r=i.required;return{questionText:n.a.mapValues(a,(function(e){if(n.a.has(e,"systemQuestion")){var i=e.systemQuestion[t]||e.systemQuestion[s];return i}if(n.a.has(e,"userQuestion"))return e.userQuestion})),answers:r.reduce((function(e,t){return n.a.set(e,t,"")}),{})}},methods:{emitData:function(){this.$emit("advanceStage",this.getData())},getData:function(){return this.answers},isValid:function(){return this.$refs.observer.validate()},save:function(){var e=this;this.isValid().then((function(t){t&&e.emitData()}))}}},k=_,S=Object(v["a"])(k,g,w,!1,null,null,null),C=S.exports,$=s("5adf"),q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return"end"===e.selfServiceDetails.tag?s("div",[s("b-alert",{attrs:{show:""}},[s("p",[e._v(e._s(e.$t("pages.selfservice.passwordReset.successMessage")))])])],1):"string"!==typeof e.selfServiceDetails.error?s("div",[s("b-form",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save(t)},submit:function(e){e.preventDefault()}}},[s("fr-policy-password-input",{attrs:{defaultPolicyFailures:e.defaultPolicyFailures,policyApi:"selfservice/reset",name:"password",label:e.$t("pages.selfservice.passwordReset.newPassword")},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),s("b-button",{attrs:{block:!0,size:"lg",variant:"primary"},on:{click:e.save}},[e._v(" "+e._s(e.$t("pages.selfservice.passwordReset.changePassword"))+" ")])],1)],1):s("div",[s("b-alert",{attrs:{variant:"danger",show:""}},[s("b",[e._v(e._s(e.$t("pages.selfservice.passwordReset.errorMessage")))]),s("p",[e._v(e._s(e.selfServiceDetails.error))])]),s("div",{staticClass:"mt-2"},[s("a",{attrs:{href:"#/passwordreset"},on:{click:e.reloadPage}},[e._v(e._s(e.$t("pages.selfservice.passwordReset.tryAgain")))])])],1)},x=[],D=s("f8f2"),O={name:"Reset-Stage",components:{"fr-policy-password-input":D["a"]},props:{selfServiceDetails:{required:!0}},data:function(){return{password:"",defaultPolicyFailures:null}},methods:{getData:function(){return{password:this.password}},save:function(){this.$emit("advanceStage",this.getData())},reloadPage:function(e){e.preventDefault();var t=window.location.hash;window.location.hash=t.substr(0,t.lastIndexOf("/")+1),window.location.reload()}},watch:{selfServiceDetails:{handler:function(e){if(Object(r["has"])(e,"requirements.error.detail.failedPolicyRequirements")){var t=Object(r["find"])(e.requirements.error.detail.failedPolicyRequirements,{property:"password"});if(t&&t.policyRequirements){var s=this.$t("common.policyValidationMessages.".concat(t.policyRequirements[0].policyRequirement),t.policyRequirements[0].params),i="".concat(this.$t("common.policyValidationMessages.policyValidationFailed",{property:t.property}),": ").concat(s);this.displayNotification("error",i),this.defaultPolicyFailures=Object(r["map"])(t.policyRequirements,"policyRequirement")}}},deep:!0}}},P=O,R=Object(v["a"])(P,q,x,!1,null,null,null),j=R.exports,E=s("e5d2"),F=s("3b97"),T={name:"Password-Reset",components:{Captcha:p["a"],EmailValidation:b,UserQuery:F["a"],ResetStage:j,kbaSecurityAnswerVerificationStage:C,GenericSelfService:$["a"],"bounce-loader":o["BounceLoader"],"fr-center-card":u["a"]},data:function(){return{selfServiceType:null,selfServiceDetails:null,loadingColor:c.a.baseColor,apiType:"reset"}},mounted:function(){if(this.$route.params.queryParams){var e=this.parseQueryParams(this.$route.params.queryParams);this.advanceStage(e)}else this.loadData()},methods:{setChildComponent:function(e,t){if(this.selfServiceDetails=t,"parameters"===e)this.selfServiceType=null,this.advanceStage({});else{var s=!1;n.a.each(this.$options.components,(function(t,i){n.a.toLower(i)===n.a.toLower(e)&&(s=!0)})),this.selfServiceType=s?e:"GenericSelfService"}},apiErrorCallback:function(e){this.setChildComponent("resetStage",{error:e.response.data.message})}},mixins:[E["a"]]},A=T,I=Object(v["a"])(A,i,a,!1,null,null,null);t["default"]=I.exports},"3b97":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-form",{on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save(t)},submit:function(e){e.preventDefault()}}},[s("p",{staticClass:"text-center mb-4"},[e._v(" "+e._s(e.$t("pages.selfservice.passwordReset.userQuery"))+" ")]),s("b-form-group",[s("fr-floating-label-input",{attrs:{fieldName:"mail",label:e.$t("common.placeholders.emailAddress"),type:"text",autofocus:"true"},model:{value:e.mail,callback:function(t){e.mail=t},expression:"mail"}})],1),s("b-button",{attrs:{size:"lg",block:!0,variant:"primary"},on:{click:e.save}},["username"===e.apiType?s("div",[e._v(" "+e._s(e.$t("pages.selfservice.forgotUsername.advanceStageButtonText"))+" ")]):s("div",[e._v(" "+e._s(e.$t("pages.selfservice.passwordReset.advanceStageButtonText"))+" ")])])],1)},a=[],r=s("49c6"),n={name:"User-Query",components:{"fr-floating-label-input":r["a"]},props:{apiType:{required:!0}},data:function(){return{mail:""}},methods:{getData:function(){return{queryFilter:'mail eq "'.concat(this.mail,'"')}},save:function(){this.$emit("advanceStage",this.getData())}}},o=n,l=s("2877"),c=Object(l["a"])(o,i,a,!1,null,null,null);t["a"]=c.exports},"5aa8":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"mb-4",attrs:{id:"captchaBody"}},[e.apiType?s("p",{staticClass:"text-center mb-4"},[e._v(" "+e._s(e.$t("pages.selfservice.headers."+e.apiType+".description"))+" ")]):e._e(),e._m(0)])},a=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"recaptcha-wrapper "},[s("div",{staticClass:"recaptcha-bound"},[s("div",{attrs:{id:"recaptchaContainer"}})])])}],r=s("2ef0"),n=s.n(r),o={name:"Captcha",props:{advanceStage:{required:!1},selfServiceDetails:{required:!0},apiType:{required:!1}},created:function(){var e=document.createElement("script");e.setAttribute("src","https://www.google.com/recaptcha/api.js"),document.head.appendChild(e)},mounted:function(){this.loadRecaptcha()},methods:{loadRecaptcha:function(){var e=this;n.a.isUndefined(this.selfServiceDetails.requirements.properties.response.recaptchaSiteKey)||0===this.selfServiceDetails.requirements.properties.response.recaptchaSiteKey.length?this.displayNotification("error",this.$t("pages.selfservice.captchaError")):setTimeout((function(){"undefined"===typeof window.grecaptcha?e.loadRecaptcha():window.grecaptcha.render("recaptchaContainer",{sitekey:e.selfServiceDetails.requirements.properties.response.recaptchaSiteKey,callback:e.handleCaptchaCallback})}),500)},handleCaptchaCallback:function(e){this.recaptchaResponse=e,this.$listeners.advanceStage&&this.$emit("advanceStage",this.getData())},getData:function(){return{response:this.recaptchaResponse,"g-recaptcha-response":this.recaptchaResponse}}}},l=o,c=s("2877"),u=Object(c["a"])(l,i,a,!1,null,null,null);t["a"]=u.exports},"5adf":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e._l(e.displayDetails,(function(t,i){return["string"===t.type||"number"===t.type?s("b-form-group",{key:"genericField"+i,attrs:{label:e._f("startCase")(t.key),"label-for":"field.key",horizontal:""}},["string"===t.type?s("b-form-input",{ref:0===i?"focusInput":"",refInFor:!0,attrs:{name:t.key,placeholder:t.text,type:"text",autocomplete:t.key},model:{value:e.saveFields[t.key],callback:function(s){e.$set(e.saveFields,t.key,"string"===typeof s?s.trim():s)},expression:"saveFields[field.key]"}}):e._e(),"number"===t.type?s("b-form-input",{ref:0===i?"focusInput":"",refInFor:!0,attrs:{horizontal:"",name:t.key,type:"number",autocomplete:t.key},model:{value:e.saveFields[t.key],callback:function(s){e.$set(e.saveFields,t.key,e._n(s))},expression:"saveFields[field.key]"}}):e._e()],1):e._e(),"boolean"===t.type?s("b-form-group",{key:"genericField"+i},[s("div",{staticClass:"form-row"},[s("label",{staticClass:"col-form-label col-sm-3",attrs:{for:t.key}},[e._v(e._s(e._f("startCase")(t.key)))]),s("div",{staticClass:"mr-auto"},[s("b-form-checkbox",{staticClass:"fr-toggle-primary",attrs:{switch:"",size:"lg"},model:{value:e.saveFields[t.key],callback:function(s){e.$set(e.saveFields,t.key,s)},expression:"saveFields[field.key]"}},[e._v(" "+e._s(e.saveFields[t.key]?e.$t("common.form.yes"):e.$t("common.form.no"))+" ")])],1)])]):e._e()]})),s("b-button",{staticClass:"mt-4",attrs:{block:!0,size:"lg",variant:"primary"},on:{click:e.save}},[e._v(" "+e._s(e.$t("common.form.submit"))+" ")])],2)},a=[],r=s("2ef0"),n=s.n(r),o={name:"Generic-Self-Service",props:{selfServiceDetails:{required:!0}},data:function(){var e={},t=[];return this.selfServiceDetails&&this.selfServiceDetails.requirements&&this.selfServiceDetails.requirements.properties&&n.a.each(this.selfServiceDetails.requirements.properties,(function(s,i){t.push({type:s.type,text:s.description,key:i}),"string"===s.type?e[i]="":"boolean"===s.type?e[i]=!1:e[i]=null})),{saveFields:e,displayDetails:t}},methods:{getData:function(){return this.saveFields},save:function(){this.$emit("advanceStage",this.getData())},isValid:function(){return Promise.resolve(!0)}},filters:{startCase:function(e){return n.a.startCase(e)}}},l=o,c=s("2877"),u=Object(c["a"])(l,i,a,!1,null,"798fd6ea",null);t["a"]=u.exports},d817:function(e,t,s){},f8f2:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-form-group",{staticClass:"mb-0"},[e._t("input",[s("fr-floating-label-input",{attrs:{name:"password",fieldName:"password",type:"password",label:e.label||e.$t("common.placeholders.password"),reveal:!0,showErrorState:!1},on:{input:function(t){return e.setFailingPolicies(t)}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})]),e._t("policy-panel",[s("fr-policy-panel",{staticClass:"mt-2",attrs:{"num-columns":e.cols,policies:e.policies,"policy-failures":e.failedPolicies}})])],2)},a=[],r=s("2ef0"),n=s("49c6"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("b-row",e._l(e.numColumns,(function(t){return s("b-col",{key:"password_policy_"+t},[s("small",[s("ul",{staticClass:"pl-4 text-left"},e._l(e.policyColumns[t-1],(function(t){return s("li",{key:t.policyId,class:[{"fr-valid":!e.includes(e.policyFailures,t.name)},"text-muted fr-policy-list-item"]},[e._v(" "+e._s(e.$t("common.policyValidationMessages."+t.name,t.params))+" ")])})),0)])])})),1)},l=[],c={name:"PolicyPanel",props:{numColumns:{type:Number,default:1},policies:{type:Array,default:function(){return[]}},policyFailures:{type:Array,default:function(){return[]}}},data:function(){return{policyColumns:[]}},computed:{numPolicies:function(){return this.policies.length}},methods:{includes:r["includes"],getPolicyColumns:function(e,t){var s=[],i=e.length,a=Math.floor(i/t),r=i%t,n=0;return e.forEach((function(e){"undefined"===typeof s[n]&&s.push([]),s[n].push({name:e.name,params:e.params});var t=n<r?a+1:a;s[n].length>=t&&(n+=1)})),s}},watch:{policies:{handler:function(e){this.policyColumns=this.getPolicyColumns(e,this.numColumns)},immediate:!0}}},u=c,p=(s("f989"),s("2877")),f=Object(p["a"])(u,o,l,!1,null,"48905e4d",null),d=f.exports,m={name:"PolicyPasswordInput",components:{"fr-floating-label-input":n["a"],"fr-policy-panel":d},props:{excludeOverwrite:{required:!1,type:Array,default:null},cols:{type:Number,default:2},failed:{type:Array,default:function(){return[]}},userPolicyObject:{type:Boolean,default:!1},label:{type:String,default:function(){return this.$t("common.placeholders.password")}},policyApi:{required:!0,type:String},value:{type:[String,Object],default:function(){return""}}},data:function(){return{failedPolicies:[],password:this.value,policies:[],policyService:function(){},serverFailures:[]}},watch:{failed:{handler:function(e){this.serverFailures=this.getFailedPolicyMessages(e)},deep:!0,immediate:!0},failedPolicies:function(e){this.$emit("valid",0===e.length)},password:function(e){this.$emit("input",e)},value:function(){this.password=this.value}},computed:{exclude:function(){return this.excludeOverwrite?this.excludeOverwrite:[{name:"REQUIRED",predicate:function(e){return Object(r["includes"])(e,"REQUIRED")&&Object(r["includes"])(e,"MIN_LENGTH")}},{name:"IS_NEW",predicate:function(){return"selfservice/registration"===this.policyApi}},"VALID_TYPE","CANNOT_CONTAIN_OTHERS"]}},methods:{isPasswordPolicyItem:Object(r["curry"])((function(e,t){return!Object(r["isEmpty"])(t[e].match("password"))})),toSimplePolicyObject:function(e){var t=e.policyRequirements,s=e.params,i=Object(r["first"])(t);return Object(r["isUndefined"])(i)?{}:{name:i,params:s}},toPolicyNames:function(e){var t=e.failedPolicyRequirements||[],s=t.filter(this.isPasswordPolicyItem("property")).map((function(e){return Object(r["at"])(e,["policyRequirements[0].policyRequirement"])}));return Object(r["flatten"])(s)},makeExclusions:function(e,t){var s=e&&e.policyRequirements?e.policyRequirements:[],i=e&&e.policies?e.policies:[],a=function(e){return Object(r["reject"])(i,(function(t){return Object(r["first"])(t.policyRequirements)===e}))};return t.forEach((function(e){Object(r["isObject"])(e)?e.predicate(s)&&(i=a(e.name)):Object(r["isString"])(e)&&Object(r["includes"])(s,e)&&(i=a(e))})),Object.assign({},e,{policyRequirements:s,policies:i})},getFailedPolicyMessages:function(e){var t=this;return 0===e.length?[]:this.failed.map((function(e){var s=e.policyRequirements[0].policyRequirement,i=e.policyRequirements[0].params;return t.$t("common.policyValidationMessages.".concat(s),i)}))},setFailingPolicies:Object(r["debounce"])((function(e){var t=this,s={password:e};this.policyApi.match("registration")&&(s={user:{password:this.password}}),this.policyService.post("/policy/".concat(this.policyApi,"/?_action=validateObject"),s).then((function(e){var s=e.data;t.failedPolicies=t.toPolicyNames(s),t.serverFailures=[]})).catch((function(){t.displayNotification("IDMMessages","error",t.$t("common.policyValidationMessages.policyServiceError.policyApi",{policyApi:t.policyApi}))}))}),200)},created:function(){var e=this,t=this.getAnonymousHeaders();this.policyService=this.getRequestService({headers:t}),this.policyService.get("/policy/".concat(this.policyApi)).then((function(t){var s=t.data;return Object(r["head"])(s.properties.filter(e.isPasswordPolicyItem("name")))})).then((function(t){return e.makeExclusions(t,e.exclude)})).then((function(t){var s=t.policies;e.policies=s.map(e.toSimplePolicyObject).filter((function(e){return!Object(r["isEmpty"])(e)}))})).catch((function(){e.displayNotification("IDMMessages","error",e.$t("common.policyValidationMessages.policyServiceError.policyApi",{policyApi:e.policyApi})),e.$router.push("/login")})),this.setFailingPolicies(this.password)}},y=m,v=Object(p["a"])(y,i,a,!1,null,null,null);t["a"]=v.exports},f989:function(e,t,s){"use strict";s("d817")}}]);
//# sourceMappingURL=chunk-9e31597a.9a691490.js.map