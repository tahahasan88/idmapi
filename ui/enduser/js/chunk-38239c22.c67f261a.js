/*!
 * Copyright 2019-2020 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-38239c22"],{"0d61":function(e,t,r){"use strict";r("4476")},4476:function(e,t,r){},"4dc1":function(e,t,r){},a368:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-container",[r("b-row",[r("b-col",[r("div",{staticClass:"d-sm-flex my-4"},[r("div",{staticClass:"media"},[r("div",{staticClass:"rounded-circle fr-resource-circle text-light bg-primary mr-4"},[r("i",{class:e.setIcon})]),r("div",{staticClass:"media-body"},[r("h1",[e._v(e._s(e.displayName))]),r("h6",{staticClass:"text-muted"},[e._v(e._s(e.secondaryTitle))])])]),e.canChangePassword||e.canDelete?r("div",{staticClass:"ml-auto my-4 my-sm-0 align-self-center align-self-end"},[r("b-dropdown",{staticClass:"m-md-2",attrs:{id:"resourceActions",text:"Actions",right:"",variant:"primary"}},[e.canChangePassword?r("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal.resetModal",modifiers:{resetModal:!0}}]},[e._v(e._s(e.$t("pages.access.resetPassword")))]):e._e(),e.canDelete?r("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal.deleteModal",modifiers:{deleteModal:!0}}]},[e._v(e._s(e.$t("common.form.delete"))+" "+e._s(this.name))]):e._e()],1)],1):e._e()])])],1),r("b-tabs",{attrs:{"content-class":"mt-4","nav-class":"nav-bar-border","flex-column":"","flex-sm-row":""}},[r("b-tab",{attrs:{title:this.$t("pages.access.details"),active:""}},[e.displayProperties.length>0?r("fr-object-type-editor",{attrs:{"form-fields":e.formFields,"display-properties":e.displayProperties,"disable-save-button":e.disableSaveButton,"resource-path":e.resource+"/"+e.name+"/"+e.id}}):r("span",[e._v(" "+e._s(e.$t("pages.access.noAvailableProperties"))+" ")])],1),e._l(e.objectTypeProperties,(function(t){return r("b-tab",{key:t.propName+"_tab",attrs:{title:t.title}},[r("fr-object-type-editor",{attrs:{"form-fields":e.formFields[t.propName]||{},"sub-property-name":t.propName,"display-properties":e.getObjectTypeProperyDisplayProperties(t),"disable-save-button":t.readOnly,"resource-path":e.resource+"/"+e.name+"/"+e.id}})],1)})),e._l(e.relationshipProperties,(function(t){return["array"===t.type?r("b-tab",{key:t.propName+"_tab",attrs:{title:t.title}},[r("fr-relationship-array",{attrs:{parentResource:e.resource+"/"+e.name,parentId:e.id,relationshipArrayProperty:t}})],1):e._e()]}))],2),e.canDelete?r("b-modal",{ref:"deleteModal",attrs:{id:"deleteModal",title:this.$t("pages.access.deleteModalTitle")}},[r("div",[e._v(" "+e._s(e.$t("pages.access.deleteConfirm"))+" "+e._s(this.name)+"? ")]),r("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[r("div",{staticClass:"float-right"},[r("b-btn",{attrs:{type:"button",variant:"danger"},on:{click:e.deleteResource}},[e._v(e._s(e.$t("common.form.delete")))])],1)])]):e._e(),e.canChangePassword?r("b-modal",{ref:"resetModal",attrs:{id:"resetModal",title:this.$t("pages.access.resetPassword")}},[r("fr-password-policy-input",{attrs:{policyApi:e.resource+"/"+e.name+"/policyTest"},model:{value:e.formFields["password"],callback:function(t){e.$set(e.formFields,"password",t)},expression:"formFields['password']"}},[r("b-form-group",{staticClass:"mb-3",attrs:{slot:"custom-input"},slot:"custom-input"},[r("label",{attrs:{for:"updatePassword"}},[e._v(e._s(e.$t("pages.access.password")))]),r("div",{staticClass:"form-label-password form-label-group mb-0"},[r("b-form-input",{attrs:{id:"updatePassword",autocomplete:"password",type:e.passwordInputType,name:"password"},model:{value:e.formFields["password"],callback:function(t){e.$set(e.formFields,"password",t)},expression:"formFields['password']"}}),r("div",{staticClass:"input-group-append"},[r("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:e.revealNew}},[r("i",{class:[{"fa-eye-slash":!e.showPassword},{"fa-eye":e.showPassword},"fa"]})])])],1)])],1),r("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[r("div",{staticClass:"float-right"},[r("b-btn",{attrs:{type:"button",variant:"primary"},on:{click:e.savePassword}},[e._v(e._s(e.$t("common.form.save")))])],1)])],1):e._e()],1)},a=[],i=r("2ef0"),o=r.n(i),n=r("bc3a"),l=r.n(n),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("b-card",[r("ValidationObserver",{ref:"observer",attrs:{slim:""}},[e._l(e.displayProperties,(function(t,s){return[t.isReadOnly||e.disableSaveButton?["string"!==t.type&&"number"!==t.type||void 0!==t.encryption?e._e():r("b-form-group",{key:"readResource"+s,attrs:{label:t.title,"label-for":"field.key",horizontal:""}},[r("b-form-input",{attrs:{horizontal:"",type:"text",plaintext:""},model:{value:e.formFields[t.key],callback:function(r){e.$set(e.formFields,t.key,r)},expression:"formFields[field.key]"}})],1),"boolean"===t.type?r("b-form-group",{key:"readResource"+s},[r("div",{staticClass:"form-row"},[r("label",{staticClass:"col-form-label col-sm-3",attrs:{for:t.title}},[e._v(e._s(t.title))]),r("b-form-checkbox",{staticClass:"mt-1 fr-toggle-primary",attrs:{switch:"",size:"lg",disabled:!0},model:{value:e.formFields[t.key],callback:function(r){e.$set(e.formFields,t.key,r)},expression:"formFields[field.key]"}},[e._v(" "+e._s(e.formFields[t.key]?e.$t("common.form.yes"):e.$t("common.form.no"))+" ")])],1)]):e._e(),"relationship"===t.type?r("b-form-group",{key:"readResource"+s},[r("div",{staticClass:"form-row"},[r("label",{staticClass:"col-form-label col-sm-3",attrs:{for:t.title}},[e._v(e._s(t.title))]),e.formFields[t.key]?r("div",{staticClass:"media-body"},[r("div",{staticClass:"text-bold pl-1"},[e._v(e._s(e.formFields[t.key][e.getRelationshipDisplayFields(t,e.formFields[t.key])[0]]))]),r("div",e._l(e.getRelationshipDisplayFields(t,e.formFields[t.key]),(function(s,a){return r("span",{directives:[{name:"show",rawName:"v-show",value:0!==a,expression:"displayFieldIndex !== 0"}],key:"displayField_"+s+"_"+a,staticClass:"pl-1 pr-1 text-muted"},[e._v(" "+e._s(e.formFields[t.key][s])+" ")])})),0)]):e._e()])]):e._e()]:["string"===t.type||"number"===t.type||"boolean"===t.type||"relationship"===t.type?r("ValidationProvider",{key:"editResource"+t.key,attrs:{name:t.title,vid:t.key,rules:t.required?"required":""},scopedSlots:e._u([{key:"default",fn:function(a){return["string"!==t.type&&"number"!==t.type||void 0!==t.encryption?"relationship"===t.type?r("fr-relationship-edit",{key:"editResource"+s,attrs:{relationshipProperty:t,index:s,value:e.formFields[t.key],setValue:e.setSingletonRelationshipValue}}):e._e():r("b-form-group",{attrs:{label:t.title,"label-for":"field.key",horizontal:""}},["string"===t.type?r("b-form-input",{ref:0===s?"focusInput":"",refInFor:!0,attrs:{name:t.key,type:"text",state:e.getValidationState(a),autocomplete:t.key},model:{value:e.formFields[t.key],callback:function(r){e.$set(e.formFields,t.key,"string"===typeof r?r.trim():r)},expression:"formFields[field.key]"}}):r("b-form-input",{ref:0===s?"focusInput":"",refInFor:!0,attrs:{horizontal:"",name:t.key,type:"number",state:e.getValidationState(a),autocomplete:t.key},model:{value:e.formFields[t.key],callback:function(r){e.$set(e.formFields,t.key,e._n(r))},expression:"formFields[field.key]"}}),r("b-form-invalid-feedback",[e._v(e._s(a.errors[0]))])],1),"boolean"===t.type?r("b-form-group",{key:"editResource"+s},[r("div",{staticClass:"form-row"},[r("label",{staticClass:"col-form-label col-sm-3",attrs:{for:t.title}},[e._v(e._s(t.title))]),r("b-form-checkbox",{staticClass:"mt-1 fr-toggle-primary",attrs:{switch:"",size:"lg"},model:{value:e.formFields[t.key],callback:function(r){e.$set(e.formFields,t.key,r)},expression:"formFields[field.key]"}},[e._v(" "+e._s(e.formFields[t.key]?e.$t("common.form.yes"):e.$t("common.form.no"))+" ")])],1)]):e._e()]}}],null,!0)}):e._e()]]}))],2),e.disableSaveButton?e._e():r("div",{staticClass:"float-right mt-4"},[r("b-btn",{attrs:{type:"button",variant:"primary"},on:{click:e.saveResource}},[e._v(e._s(e.$t("common.form.save")))])],1)],1)},d=[],p=r("f13c"),u=r("eea2"),h={name:"ObjectTypeEditor",components:{"fr-relationship-edit":p["a"]},props:{displayProperties:{type:Array,default:function(){return[]}},formFields:{type:Object,default:function(){}},resourcePath:{type:String,default:""},disableSaveButton:{type:Boolean,default:!1},isOpenidmAdmin:{type:Boolean,default:!1},subPropertyName:{type:String,default:null,required:!1}},mixins:[u["a"]],data:function(){return{oldFormFields:{}}},methods:{getRelationshipDisplayFields:function(e,t){return o.a.find(e.resourceCollection,{path:t._refResourceCollection}).query.fields},setSingletonRelationshipValue:function(e,t){this.formFields[e]=t},saveResource:function(){var e=this;this.$refs.observer.reset();var t=this.getRequestService();this.$refs.observer.validate().then((function(r){if(r){var s;if(e.subPropertyName){var a={},i={};a[e.subPropertyName]=o.a.clone(e.oldFormFields),i[e.subPropertyName]=o.a.clone(e.formFields),s=e.generateUpdatePatch(a,i)}else s=e.generateUpdatePatch(o.a.clone(e.oldFormFields),o.a.clone(e.formFields));t.patch(e.resourcePath,s).then((function(){e.oldFormFields=o.a.clone(e.formFields),e.displayNotification("success",e.$t("pages.access.successEdited",{resource:o.a.capitalize(e.name)}))}),(function(t){var r=e.findPolicyError(t.response,e.displayProperties);if(r.length>0){var s={};o.a.each(r,(function(e){e.exists&&(void 0!==s[e.field]?s[e.field].push(e.msg):s[e.field]=[e.msg])})),e.$refs.observer.setErrors(s)}else e.displayNotification("error",e.$t("pages.access.invalidEdit"))}))}else e.displayNotification("error",e.$t("pages.access.invalidEdit"))}))}},mounted:function(){this.displayProperties.forEach((function(e){var t=e.title&&e.title.length>0,r=e.description&&e.description.length>0;!t&&r&&(e.title=e.description)})),this.oldFormFields=o.a.clone(this.formFields)}},f=h,m=r("2877"),y=Object(m["a"])(f,c,d,!1,null,null,null),b=y.exports,v=r("f8f2"),g=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"card mt-3"},[r("div",{directives:[{name:"show",rawName:"v-show",value:!e.relationshipArrayProperty.isReadOnly,expression:"!relationshipArrayProperty.isReadOnly"}],staticClass:"px-4 py-2"},[r("b-row",[r("b-col",{staticClass:"my-1",attrs:{md:"5"}},[r("b-btn",{staticClass:"mr-1",attrs:{type:"button",variant:"primary",id:"add_"+e.relationshipArrayProperty.key},on:{click:e.openCreateModal}},[r("i",{staticClass:"fa fa-plus mr-3"}),e._v(e._s(e.$t("common.form.new"))+" "+e._s(e.relationshipArrayProperty.title)+" ")]),r("b-button",{directives:[{name:"show",rawName:"v-show",value:e.selected.length>0,expression:"selected.length > 0"}],attrs:{variant:"outline-primary",id:"delete_"+e.relationshipArrayProperty.key},on:{click:function(t){return e.$bvModal.show(e.removeModalId)}}},[r("i",{staticClass:"fa fa-trash mr-3"}),e._v(e._s(e.$t("common.form.remove"))+" ")])],1),e.showFilter&&!e.disableSortAndSearch?r("b-col",{staticClass:"my-1",attrs:{md:"7"}},[r("div",{staticClass:"d-flex"},[r("b-input-group",[r("b-input-group-prepend",[r("div",{staticClass:"input-group-text inset"},[r("i",{staticClass:"fa fa-search"})])]),r("b-form-input",{staticClass:"inset-left inset-right",attrs:{placeholder:e.searchPlaceholder},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),r("b-input-group-append",[r("b-btn",{staticClass:"inset clear",attrs:{variant:"outline-default",disabled:!e.filter},on:{click:e.clear}},[r("i",{staticClass:"fa fa-times-circle"})])],1)],1)],1)]):e._e()],1)],1),r("b-table",{ref:"relationshipArrayGrid",staticClass:"mb-0",class:[{"hide-header":!e.gridData.length}],attrs:{"show-empty":"","table-responsive":"",stacked:"lg",fields:e.columns,items:e.gridData,"per-page":0,hover:e.tableHover,"no-local-sorting":!0,"sort-by":e.sortBy,"sort-desc":e.sortDesc,"sort-direction":e.sortDirection,selectable:!e.relationshipArrayProperty.isReadOnly,"selected-variant":"active"},on:{"update:sortBy":function(t){e.sortBy=t},"update:sort-by":function(t){e.sortBy=t},"update:sortDesc":function(t){e.sortDesc=t},"update:sort-desc":function(t){e.sortDesc=t},"row-clicked":e.resourceClicked,"row-selected":e.onRowSelected,"sort-changed":e.sortingChanged},scopedSlots:e._u([{key:"head(selected)",fn:function(){return[r("div",{directives:[{name:"show",rawName:"v-show",value:e.gridData.length>0,expression:"gridData.length > 0"}],staticClass:"cursor-pointer"},[r("b-form-checkbox",{staticClass:"pl-4",on:{change:e.toggleSelectAll},model:{value:e.allRowsSelected,callback:function(t){e.allRowsSelected=t},expression:"allRowsSelected"}})],1)]},proxy:!0},{key:"cell(selected)",fn:function(t){return[r("b-form-checkbox",{staticClass:"pl-4",attrs:{id:"rowSelectCheckbox_"+e.relationshipArrayProperty.key+t.index},on:{change:function(r){return e.onSelectRowCheckboxClicked(r,t.index)}},model:{value:t.rowSelected,callback:function(r){e.$set(t,"rowSelected",r)},expression:"data.rowSelected"}})]}},{key:"cell(_relationshipDetails)",fn:function(t){return[r("div",{staticClass:"media cursor-pointer"},[r("div",{staticClass:"media-body"},[r("div",{staticClass:"text-bold"},[e._v(e._s(t.value[0]))]),r("div",e._l(t.value,(function(t,s){return r("span",{directives:[{name:"show",rawName:"v-show",value:0!==s,expression:"index !== 0"}],key:"displayField_"+t+"_"+s,staticClass:"pr-1 text-muted"},[e._v(" "+e._s(t)+" ")])})),0)])])]}}])}),r("div",{directives:[{name:"show",rawName:"v-show",value:e.gridData.length,expression:"gridData.length"}],staticClass:"card-footer py-2"},[r("nav",{attrs:{"aria-label":"Page navigation example"}},[r("ul",{staticClass:"pagination justify-content-center mb-0"},[r("li",{class:[{disabled:1===e.currentPage},"page-item"],on:{click:function(t){t.preventDefault(),1!==e.currentPage&&e.paginationChange(1)}}},[e._m(0)]),r("li",{class:[{disabled:1===e.currentPage},"page-item"],on:{click:function(t){t.preventDefault(),1!==e.currentPage&&e.paginationChange(e.currentPage-1)}}},[e._m(1)]),r("li",{class:[{disabled:e.lastPage},"page-item"],on:{click:function(t){t.preventDefault(),!e.lastPage&&e.paginationChange(e.currentPage+1)}}},[e._m(2)])])])]),r("b-modal",{ref:e.createModalId,attrs:{id:e.createModalId,title:"Add "+e.relationshipArrayProperty.title}},[r("fr-relationship-edit",{attrs:{relationshipProperty:e.relationshipArrayProperty,index:0,setValue:e.addNewRelationship}}),r("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[r("div",{staticClass:"float-right"},[r("b-btn",{attrs:{variant:"outline-secondary mr-2"},on:{click:function(t){return e.$bvModal.hide(e.createModalId)}}},[e._v(" "+e._s(e.$t("common.form.cancel"))+" ")]),r("b-btn",{attrs:{type:"button",variant:"primary",id:"save_new_"+e.relationshipArrayProperty.key,disabled:0===e.newRelationships.length},on:{click:e.saveNewRelationships}},[e._v(" "+e._s(e.$t("common.form.save"))+" ")])],1)])],1),r("b-modal",{ref:e.removeModalId,attrs:{id:e.removeModalId,title:e.$t("pages.access.removeModalTitle")}},[r("div",[e._v(" "+e._s(e.$t("pages.access.removeConfirm"))+" "+e._s(e.relationshipArrayProperty.title)+"? ")]),r("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[r("div",{staticClass:"float-right"},[r("b-btn",{attrs:{variant:"btn-link text-danger mr-2"},on:{click:function(t){return e.$bvModal.hide(e.removeModalId)}}},[e._v(e._s(e.$t("common.form.cancel")))]),r("b-btn",{attrs:{type:"button",variant:"danger"},on:{click:e.removeRelationships}},[e._v(e._s(e.$t("common.form.remove")))])],1)])])],1)},_=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a",{staticClass:"page-link",attrs:{href:"#"}},[r("i",{staticClass:"fa fa-angle-double-left"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a",{staticClass:"page-link",attrs:{href:"#"}},[r("i",{staticClass:"fa fa-angle-left"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a",{staticClass:"page-link",attrs:{href:"#"}},[r("i",{staticClass:"fa fa-angle-right"})])}],w=r("761a"),P=r.n(w);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var R={name:"RelationshipArray",components:{"fr-relationship-edit":p["a"]},mixins:[u["a"]],props:{parentId:{type:String,required:!0},relationshipArrayProperty:{type:Object,required:!0},parentResource:{type:String,required:!0}},data:function(){return{gridPageSize:10,allRowsSelected:!1,tableHover:!0,gridData:[],columns:[],currentPage:1,sortBy:null,sortDesc:!1,filter:"",lastPage:!1,sortDirection:"asc",createModalId:"create_".concat(this.relationshipArrayProperty.propName,"_modal"),removeModalId:"delete_".concat(this.relationshipArrayProperty.propName,"_modal"),newRelationships:[],selected:[],showFilter:!1,queryThreshold:null,disableSortAndSearch:!1,requiredProps:["_ref","_refResourceCollection","_refResourceId","_refProperties"]}},watch:{gridData:function(){var e=this;this.columns=this.columns.map((function(t){return"actions"!==t.key&&(t.sortable=!e.disableSortAndSearch&&!e.queryThreshold||e.filter.length>=e.queryThreshold),t}))}},computed:{searchPlaceholder:function(){return this.queryThreshold?this.$t("pages.access.typeAtLeastAndEnterToSearch",{numChars:this.queryThreshold}):this.$t("pages.access.typeAndEnterToSearch")}},mounted:function(){this.loadGrid(1)},methods:{loadGrid:function(e){var t=this,r=this.getRequestService(),s=this.relationshipArrayProperty.items.resourceCollection[0].path.split("/")[1],a=this.$root.applicationStore.state.managedObjectsSettings,o=function(s){r.get(t.buildGridUrl(e,s)).then((function(e){e.data.pagedResultsCookie?t.lastPage=!1:t.lastPage=!0,t.relationshipArrayProperty.isReadOnly||t.columns.push({key:"selected",label:"",class:"checkbox-column"}),s?t.relationshipArrayProperty.items.resourceCollection[0].query.fields.forEach((function(e){t.columns.push({key:e,label:s.properties[e].title||P.a.singular(e),sortable:!0,sortDirection:"desc"})})):t.columns.push({key:"_relationshipDetails",label:P.a.singular(t.relationshipArrayProperty.title)}),t.gridData=[],t.setGridData(e.data.result,t.relationshipArrayProperty)})).catch((function(e){t.displayNotification("error",e.response.data.message)}))};if(a&&a[s]&&(this.queryThreshold=a[s].minimumUIFilterLength),Object(i["has"])(this.relationshipArrayProperty,"items.resourceCollection")&&1===this.relationshipArrayProperty.items.resourceCollection.length){var n=this.relationshipArrayProperty.items.resourceCollection[0];this.setDisableSortAndSearch(n),this.getSchema(this.relationshipArrayProperty.items.resourceCollection[0].path).then((function(e){t.showFilter=!0,o(e.data)}))}else o()},setDisableSortAndSearch:function(e){var t=this.$root.applicationStore.state.managedObjectsSettings,r=e.path.split("/")[0],s=e.path.split("/")[1];"role"===s&&"internal"===r&&(s="internalrole"),this.disableSortAndSearch=!(this.isOpenidmAdmin||!Object(i["has"])(t,s))&&t[s].disableRelationshipSortAndSearch},setGridData:function(e,t){var r=this,s=function(){e.forEach((function(e){var s=Object(i["find"])(t.items.resourceCollection,{path:e._refResourceCollection});s&&Object(i["has"])(s,"path")&&"internal/user"===s.path?e._relationshipDetails=[Object(i["last"])(e._ref.split("/"))]:e._relationshipDetails=s?Object(i["toArray"])(Object(i["pick"])(e,s.query.fields)):[e._id],r.gridData.push(e)}))};if(this.disableSortAndSearch){var a=[];e.forEach((function(s,o){var n=Object(i["find"])(t.items.resourceCollection,{path:s._refResourceCollection});a.push(r.getRelationshipFieldsData(s,n.query.fields).then((function(t){e[o]=C(C({},s),t)})))})),Promise.all(a).then((function(){s()}))}else s()},getRelationshipFieldsData:function(e,t){return this.getRequestService().get("".concat(e._ref,"?_fields=").concat(t)).then((function(e){return Object(i["pick"])(e.data,t)}))},buildGridUrl:function(e,t){var r=Object(i["find"])(this.relationshipArrayProperty.items.resourceCollection,{path:t?t.resourceCollection:null}),s=this.additionalQueryFilter?this.parentResource:"".concat(this.parentResource,"/").concat(this.parentId,"/").concat(this.relationshipArrayProperty.propName),a=this.filter?this.generateSearch(this.filter,r.query.fields,t.properties):"",o="".concat(s,"?_pageSize=").concat(this.gridPageSize,"&_totalPagedResultsPolicy=ESTIMATE");if(o=a?"".concat(o,"&_queryFilter=").concat(a):"".concat(o,"&_queryFilter=true"),!this.disableSortAndSearch&&r){var n=this.requiredProps.join(","),l=r.query.fields.join(",");o="".concat(o,"&_fields=").concat(n,",").concat(l)}if(e>1){var c=e*this.gridPageSize;o="".concat(o,"&_pagedResultsOffset=").concat(c)}if(this.sortBy){var d=null;Object(i["isNull"])(this.sortBy)||(d=this.sortDesc?"".concat(this.sortBy):"-".concat(this.sortBy)),o="".concat(o,"&_sortKeys=").concat(d)}return o},paginationChange:function(e){this.currentPage=e,this.loadGrid(e)},resourceClicked:function(e){this.$router.push({name:"EditResource",params:{resourceType:e._refResourceCollection.split("/")[0],resourceName:e._refResourceCollection.split("/")[1],resourceId:e._refResourceId}})},openCreateModal:function(){this.$bvModal.show(this.createModalId),this.newRelationships=[]},addNewRelationship:function(e,t){t&&this.newRelationships.push(t)},onRowSelected:function(e){this.selected=e,this.allRowsSelected=e.length===this.gridData.length},toggleSelectAll:function(e){e?this.$refs.relationshipArrayGrid.selectAllRows():this.$refs.relationshipArrayGrid.clearSelected()},saveNewRelationships:function(){this.updateRelationship("add",this.newRelationships)},removeRelationships:function(){var e=[],t=["_ref","_refResourceCollection","_refResourceId","_refProperties"];this.selected.forEach((function(r){r&&e.push(Object(i["pick"])(r,t))})),this.updateRelationship("remove",e)},updateRelationship:function(e,t){var r=this,s=Object(i["map"])(t,(function(t){return"remove"===e?{operation:"remove",field:"/"+r.relationshipArrayProperty.propName,value:t}:{operation:"add",field:"/"+r.relationshipArrayProperty.propName+"/-",value:t}})),a="remove"===e?"pages.access.successRemoved":"pages.access.successAdded",o=this.getRequestService(),n=function(){var t="remove"===e?r.removeModalId:r.createModalId;r.loadGrid(1),r.$bvModal.hide(t)};o.patch("".concat(this.parentResource,"/").concat(this.parentId),s).then((function(){n(),r.displayNotification("success",r.$t(a,{resource:r.relationshipArrayProperty.title}))})).catch((function(e){n(),r.displayNotification("error",e.response.data.message)}))},sortingChanged:function(e){this.currentPage=1,this.sortBy=e.sortBy,this.sortDesc=e.sortDesc,this.loadGrid(1)},clear:function(){this.filter="",this.sortBy=null,this.sortDesc=!1,this.currentPage=1,this.loadGrid(1)},search:function(){""!==this.filter?(this.sortBy=null,this.sortDesc=!1,this.currentPage=1,(!this.queryThreshold||!this.filter.length||this.filter.length>=this.queryThreshold)&&this.loadGrid(1)):this.clear()},onSelectRowCheckboxClicked:function(e,t){e?this.$refs.relationshipArrayGrid.selectRow(t):this.$refs.relationshipArrayGrid.unselectRow(t)}}},S=R,$=(r("0d61"),Object(m["a"])(S,g,_,!1,null,"042d10c6",null)),O=$.exports,A={name:"Edit-Resource",components:{"fr-object-type-editor":b,"fr-password-policy-input":v["a"],"fr-relationship-array":O},mixins:[u["a"]],data:function(){return{name:this.$route.params.resourceName,resource:this.$route.params.resourceType,id:this.$route.params.resourceId,displayProperties:[],canDelete:!1,canChangePassword:!1,passwordInputType:"password",showPassword:!0,disableSaveButton:!1,icon:"",displayNameField:"",displaySecondaryTitleField:"",formFields:{},oldFormFields:{},objectTypeProperties:{},relationshipProperties:{}}},mounted:function(){this.loadData()},methods:{loadData:function(){var e=this,t=this.getRequestService();l.a.all([this.getSchema("".concat(this.resource,"/").concat(this.name)),t.get("privilege/".concat(this.resource,"/").concat(this.name,"/").concat(this.id))]).then(l.a.spread((function(r,s){var a="";e.objectTypeProperties=e.getObjectTypeProperties(r.data,s.data),e.relationshipProperties=e.getRelationshipProperties(r.data,s.data),a=e.buildResourceUrl(),t.get(a).then((function(t){e.generateDisplay(r.data,s.data,t.data)})).catch((function(t){e.displayNotification("error",t.response.data.message)}))}))).catch((function(t){e.displayNotification("error",t.response.data.message)}))},buildResourceUrl:function(){var e="".concat(this.resource,"/").concat(this.name,"/").concat(this.id,"?_fields=*"),t=o.a.filter(this.relationshipProperties,{type:"relationship"});return t.length&&(e+=",".concat(o.a.map(t,(function(e){return e.propName+"/*"})).join(","))),e},getObjectTypeProperties:function(e,t){return o.a.pickBy(e.properties,(function(e,r){var s=t.VIEW.properties.includes(r)||t.UPDATE.properties.includes(r),a="object"===e.type&&e.viewable;return e.propName=r,e.readOnly=!t.UPDATE.properties.includes(r),a&&s}))},getObjectTypeProperyDisplayProperties:function(e){var t=this;return o.a.map(e.order,(function(r){var s=e.properties[r];return s.key=r,s.value=t.formFields[e.propName]&&t.formFields[e.propName][r]||null,e.readOnly&&!t.isOpenidmAdmin?s.disabled=!0:s.disabled=!1,e.properties[r]}))},getRelationshipProperties:function(e,t){return o.a.pickBy(e.properties,(function(e,r){var s=t.VIEW.properties.indexOf(r)>-1||t.UPDATE.properties.indexOf(r)>-1,a="relationship"===e.type||"array"===e.type&&"relationship"===e.items.type;return e.propName=r,a&&(e.isReadOnly=-1===t.UPDATE.properties.indexOf(r)),a&&s}))},generateDisplay:function(e,t,r){var s=this;this.oldFormFields=o.a.pick(r,t.VIEW.properties),t.DELETE.allowed&&(this.canDelete=!0),e.icon?this.icon=e.icon:this.icon="",o.a.each(this.oldFormFields,(function(e,t){s.$set(s.formFields,t,e)})),t.VIEW.allowed&&(0===t.UPDATE.properties.length&&(this.disableSaveButton=!0),o.a.each(this.mergePrivilegeProperties(t,e),(function(t){var r=e.properties[t.attribute];-1!==o.a.indexOf(e.required,t.attribute)&&(r.required=!0),"password"!==t.attribute||t.readOnly||(s.canChangePassword=!0),r.key=t.attribute,"_id"!==t.attrubute&&0===s.displayNameField.length&&(s.displayNameField=t.attribute),"title"!==o.a.toLower(t.attribute)&&"email"!==o.a.toLower(t.attribute)&&"type"!==o.a.toLower(t.attribute)&&"mail"!==o.a.toLower(t.attribute)||0!==s.displaySecondaryTitleField.length||(s.displaySecondaryTitleField=t.attribute),o.a.isUndefined(s.formFields[t.attribute])&&("boolean"===r.type?(s.$set(s.formFields,t.attribute,!1),s.oldFormFields[t.attribute]=!1):(s.$set(s.formFields,t.attribute,""),s.oldFormFields[t.attribute]="")),t.readOnly&&(r.isReadOnly=!0),s.displayProperties.push(r)})))},deleteResource:function(){var e=this,t=this.getRequestService();this.$refs.deleteModal.hide(),t.delete("".concat(this.resource,"/").concat(this.name,"/").concat(this.id)).then((function(){e.displayNotification("success",e.$t("pages.access.deleteResource")),e.$router.push({name:"ListResource",params:{resourceType:e.resource,resourceName:e.name}})})).catch((function(t){e.displayNotification("error",t.response.data.message)}))},revealNew:function(){"password"===this.passwordInputType?(this.passwordInputType="text",this.showPassword=!1):(this.passwordInputType="password",this.showPassword=!0)},savePassword:function(){var e=this,t=this.getRequestService(),r=[{operation:"add",field:"/password",value:this.formFields["password"]}];this.$refs.resetModal.hide(),this.formFields["password"]="",t.patch("".concat(this.resource,"/").concat(this.name,"/").concat(this.id),r).then((function(){e.displayNotification("success",e.$t("pages.access.successSavePassword"))}),(function(){e.displayNotification("error",e.$t("pages.access.failedSavePassword"))}))},mergePrivilegeProperties:function(e,t){var r=[];return o.a.each(t.order,(function(t){var s=o.a.indexOf(e.VIEW.properties,t)>-1,a=o.a.indexOf(e.UPDATE.properties,t)>-1,i={attribute:t};a?r.push(i):s&&(i.readOnly=!0,r.push(i))})),r}},computed:{secondaryTitle:function(){var e="".concat(this.resource," - ").concat(this.name);return this.displaySecondaryTitleField.length>0&&(e=this.formFields[this.displaySecondaryTitleField]),e},displayName:function(){var e=this.id;return this.displayNameField.length>0&&(e=this.formFields[this.displayNameField]),e},setIcon:function(){var e="fa-cube";return this.icon.length>0&&(e=this.icon),"fa fa-3x ".concat(e)}}},x=A,D=(r("e964"),Object(m["a"])(x,s,a,!1,null,"9eb32a66",null));t["default"]=D.exports},e964:function(e,t,r){"use strict";r("4dc1")}}]);
//# sourceMappingURL=chunk-38239c22.c67f261a.js.map